name: Publish to Azure DevOps Marketplace

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - uses: octokit/graphql-action@v2.x
        id: get_total_count
        with:
          query: |
            query {
              organization(login: "microsoft") {
                teams(
                  first: 10,
                  userLogins: ["${{ github.actor }}"]
                  query: "Retrospective-Extension-Admin"
                ) {
                  totalCount
                }
              }
            }
        env:
          GITHUB_TOKEN: ${{ secrets.PERSONAL_TOKEN_READ_ORG }}

      - name: Check if the specified team exists
        run: |
          if [ ${{ steps.get_total_count.outputs.data }} -eq 0 ]; then
            echo "You are not part of the specified team."
            exit 1
          fi

      - name: Continue execution if the specified team
        run: |
          echo "Congratulations! You are part of the specified team."
